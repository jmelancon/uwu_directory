{% extends "/layouts/tabbed.html.twig" %}
{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('admin') }}
{% endblock %}
{% block sidebar %}
    <twig:sidebar-item icon="bi-person-fill" tab="view_users" name="Users" selected/>
    <twig:sidebar-item icon="bi-person-plus-fill" tab="add_user" name="Add User" parent="view_users"/>
    <twig:sidebar-item icon="bi-person-fill-gear" tab="edit_user" name="Edit User" parent="view_users"/>


    <twig:sidebar-item icon="bi-building-fill" tab="view_groups" name="Groups"/>
    <twig:sidebar-item icon="bi-building-fill-add" tab="add_group" name="Add Group" parent="view_groups"/>
    <twig:sidebar-item icon="bi-building-fill-gear" tab="edit_members" name="View Members" parent="view_groups"/>

    <twig:sidebar-item icon="bi-database-fill" tab="view_services" name="View Services (LDAP)"/>
    <twig:sidebar-item icon="bi-database-fill-add" tab="add_service" name="Add Service (LDAP)" parent="view_services"/>

    <twig:sidebar-item icon="bi-gear-fill" tab="config" name="Config"/>
{% endblock %}
{% block panels %}
    <twig:panel id="view_users" heading="User Overview" selected>
        <table id="example" class="display table table-striped table-responsive">
            <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Username</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </twig:panel>
    <twig:panel id="add_user" heading="Add New User">
        <p>Fill out the form below to add a new user.</p>
        <form class="gap-2">
            <div class="row row-gap-2 mb-2">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="identifier" name="identifier" placeholder="Username"/>
                        <label class="form-label" for="identifier">Username</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="email" name="email" placeholder="Email"/>
                        <label class="form-label" for="email">Email</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="firstName" name="firstName" placeholder="First Name"/>
                        <label class="form-label" for="firstName">First Name</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="lastName" name="lastName" placeholder="Last Name"/>
                        <label class="form-label" for="lastName">Last Name</label>
                    </div>
                </div>
            </div>
            <button
                    type="submit"
                    class="btn btn-primary"
                    data-request-method="POST"
                    data-request-path="{{ path("api.v1.user.create") }}">
                Create
            </button>
        </form>
    </twig:panel>
    <twig:panel heading="Edit User" id="edit_user">
        <div id="edit_user_landing" class="">
            <p>Select a user in the users tab to begin.</p>
        </div>
        <div id="edit_user_skeleton" class="visually-hidden">
            <div class="row row-gap-2 mb-2 p-2 placeholder-glow placeholder-lg fs-1">
                <span class="col-md-6 placeholder"></span>
                <span class="col-md-6 placeholder"></span>
                <span class="col-md-6 placeholder"></span>
                <span class="col-md-6 placeholder"></span>
                <a href="#" tabindex="-1" class="btn btn-primary disabled placeholder col-1" aria-hidden="true"></a>
            </div>
        </div>
        <div id="edit_user_editor" class="visually-hidden">
            <form class="gap-2">
                <div class="row row-gap-2 mb-2">
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input class="form-control" type="text" id="identifier" name="identifier" placeholder="Username"/>
                            <label class="form-label" for="identifier">Username</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input class="form-control" type="text" id="email" name="email" placeholder="Email"/>
                            <label class="form-label" for="email">Email</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input class="form-control" type="text" id="firstName" name="firstName" placeholder="First Name"/>
                            <label class="form-label" for="firstName">First Name</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input class="form-control" type="text" id="lastName" name="lastName" placeholder="Last Name"/>
                            <label class="form-label" for="lastName">Last Name</label>
                        </div>
                    </div>
                </div>

                <div class="row py-3 pb-4">
                    {% for group in groups %}
                        {% set cn = group.getAttribute("cn")[0] %}
                        {% set dn = group.getDn() %}
                        <div class="col-md-4">
                            <input class="form-check-input" type="checkbox" name="roleDNs[{{ dn }}]" id="edit_user_group_{{ dn }}"/>
                            <label class="form-check-label" for="edit_user_group_{{ dn }}" class="pt-3">{{ cn }}</label>
                        </div>
                    {% endfor %}
                </div>

                <button
                        type="submit"
                        class="btn btn-primary"
                        data-request-method="POST"
                        data-request-path="#">
                    Update
                </button>
            </form>
        </div>
    </twig:panel>
    <twig:panel heading="Manage Groups" id="view_groups">
        <table id="view_groups_datatable" class="display table table-striped table-responsive">
            <thead>
            <tr>
                <th>Group Name</th>
                <th>Number of Members</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </twig:panel>
    <twig:panel heading="Add Group" id="add_group">
        <p>Fill out the form below to add a new group.</p>
        <form class="gap-2">
            <div class="row row-gap-2 mb-2">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="name" name="name" placeholder="Group Name"/>
                        <label class="form-label" for="name">Group Name</label>
                    </div>
                </div>
            </div>
            <button
                    type="submit"
                    class="btn btn-primary"
                    data-request-method="POST"
                    data-request-path="{{ path("api.v1.group.create") }}">
                Create
            </button>
        </form>
    </twig:panel>
    <twig:panel heading="Edit Group Membership" id="edit_members">
        <p>Pick a group from the View Groups tab to begin.</p>
        <table id="edit_members_datatable" class="display table table-striped table-responsive visually-hidden">
            <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Username</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </twig:panel>
    <twig:panel heading="View Services (LDAP)" id="view_services">
        <table id="view_services_datatable" class="display table table-striped table-responsive">
            <thead>
            <tr>
                <th>Service Name</th>
                <th>FQCN</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </twig:panel>
    <twig:panel heading="Add Service (LDAP)" id="add_service">
        <p>
            Fill out the form below to add a new service. Upon service creation,
            access credentials will be generated
            and returned for use with the service's LDAP integration.
        </p>
        <form class="gap-2">
            <div class="row row-gap-2 mb-2">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="name" name="name" placeholder="Service Name"/>
                        <label class="form-label" for="name">Service Name</label>
                    </div>
                </div>
            </div>
            <button
                    type="submit"
                    class="btn btn-primary"
                    data-request-method="POST"
                    data-request-path="{{ path("api.v1.service.create") }}">
                Create
            </button>
        </form>
    </twig:panel>
    <twig:panel heading="Manage Configuration" id="config">
        <p>
            Options for your instance of uwu_directory may be configured here. Configuration will be written to
            <code>/var/server/custom.scss</code> and <code>/var/server/config.json</code>, so ensure that your Docker
            volumes are properly configured to store these files.
        </p>
        <form class="gap-2">
            <hr/>
            <div class="row row-gap-2 mb-2">
                <h4>Site Branding</h4>
                <p>
                    Across the interface, two values are used for populating branded text fields: the service name
                    and the organization name. The service name refers to this webpage, the product users interact with,
                    and the organization name refers to you, the organization hosting the service.
                </p>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="service" name="service" placeholder="Service Name" value="{{ config("service") }}"/>
                        <label class="form-label" for="service">Service Name</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="organization" name="organization" placeholder="Organization Name" value="{{ config("organization") or "" }}"/>
                        <label class="form-label" for="organization">Organization Name</label>
                    </div>
                </div>
            </div>
            <hr/>
            <div class="row row-gap-2 mb-2">
                <h4>Organizational Constraints</h4>
                <p>
                    In certain cases, it may be desirable to restrict registrations to a specific email domain.
                    By specifying a suffix formatted like <code>@example.com</code> in the field below, all new
                    registrations will be required to be suffixed with this string.
                </p>
                <div class="col-md-6">
                    <div class="form-floating">
                        <input class="form-control" type="text" id="emailSuffix" name="emailSuffix" placeholder="Email Suffix" value="{{ config("emailSuffix") or "" }}"/>
                        <label class="form-label" for="emailSuffix">Email Suffix</label>
                    </div>
                </div>
            </div>
            <hr/>
            <div class="row row-gap-2 mb-2">
                <h4>Site Styling</h4>
                <p>
                    uwu_directory utilizes Bootstrap 5.3 for stylesheets. You may use the below textarea to
                    specify custom SCSS variables to be employed by this framework. For more information on available
                    variables, refer to the
                    <a href="https://getbootstrap.com/docs/5.3/customize/sass/">Bootstrap documentation</a>.
                </p>
                <div class="col-md-12">
                    <div class="form-floating">
                        <textarea
                            class="form-control font-monospace"
                            id="customScss" name="customScss"
                            placeholder="Custom SCSS" style="height: 12em; font-size: 14px;" type="text">{{ config("customScss") }}</textarea>
                        <label class="form-label" for="customScss">Custom SCSS</label>
                    </div>
                </div>
            </div>
            <button
                    type="submit"
                    class="btn btn-primary"
                    data-request-method="POST"
                    data-request-path="{{ path("api.v1.config.create") }}">
                Save
            </button>
        </form>
    </twig:panel>
{% endblock %}